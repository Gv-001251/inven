<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Breeze Techniques - Complete Barcode Labels</title>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .header h1 {
            color: #333;
            margin-bottom: 15px;
            font-size: 28px;
        }

        .header p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f39c12;
            color: white;
        }

        .btn-secondary:hover {
            background: #e67e22;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.4);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        .section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 12px;
            margin: 30px 0 20px 0;
            font-size: 22px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .labels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .label-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            page-break-inside: avoid;
            border: 2px solid transparent;
        }

        .label-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.2);
            border-color: #667eea;
        }

        .label-card.finished-product {
            border-left: 4px solid #10b981;
        }

        .label-card.component {
            border-left: 4px solid #667eea;
        }

        .component-name {
            font-size: 16px;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
            word-wrap: break-word;
            max-width: 100%;
        }

        .category-badge {
            font-size: 11px;
            background: #f0f4ff;
            color: #667eea;
            padding: 4px 10px;
            border-radius: 12px;
            margin-bottom: 15px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .category-badge.finished {
            background: #d1fae5;
            color: #065f46;
        }

        .barcode-container {
            margin: 15px 0;
            display: flex;
            justify-content: center;
            width: 100%;
        }

        .barcode-container svg {
            max-width: 100%;
            height: auto;
        }

        .serial-number {
            font-size: 14px;
            font-weight: 700;
            color: #667eea;
            margin-top: 15px;
            letter-spacing: 1px;
            font-family: 'Courier New', monospace;
            background: #f0f4ff;
            padding: 8px 12px;
            border-radius: 6px;
            width: 100%;
            word-break: break-all;
        }

        .serial-number.finished {
            color: #10b981;
            background: #d1fae5;
        }

        .serial-label {
            font-size: 11px;
            color: #999;
            margin-top: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .header, .controls {
                display: none;
            }

            .section-header {
                background: #333;
                page-break-before: always;
            }

            .section-header:first-of-type {
                page-break-before: auto;
            }

            .labels-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }

            .label-card {
                page-break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ddd;
                padding: 15px;
            }
        }

        .info-box {
            background: #e8f4f8;
            padding: 15px;
            border-left: 4px solid #667eea;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 13px;
            color: #555;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            color: white;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            display: block;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 13px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè≠ Breeze Techniques - Complete Barcode System</h1>
            <p>Generate printable barcode labels for all inventory components and finished products. Each label includes a Code 128 barcode and unique serial number.</p>
            
            <div class="stats">
                <div class="stat-item">
                    <span class="stat-number" id="componentCount">0</span>
                    <span class="stat-label">üì¶ Raw Components</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="productCount">0</span>
                    <span class="stat-label">üè≠ Finished Products</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="totalCount">0</span>
                    <span class="stat-label">üè∑Ô∏è Total Barcodes</span>
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-primary" onclick="refreshData()">üîÑ Refresh Data</button>
                <button class="btn btn-primary" onclick="generateAllBarcodes()">üè∑Ô∏è Generate All Barcodes</button>
                <button class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è Print All Labels</button>
                <button class="btn btn-success" onclick="downloadComponentsCSV()">üì• Export Components</button>
                <button class="btn btn-success" onclick="downloadProductsCSV()">üì• Export Products</button>
            </div>

            <div class="info-box">
                ‚ÑπÔ∏è <strong>Tip:</strong> Components use format COMP-XXX, Finished Products use FP-XXX-XXX. Print on adhesive label sheets for easy application. Scan with any barcode scanner to retrieve data instantly.
            </div>
        </div>

        <!-- Raw Material Components Section -->
        <div class="section-header">
            üì¶ Raw Material Components (Inventory)
        </div>
        <div class="labels-grid" id="componentsContainer">
            <!-- Component barcode labels will be generated here -->
        </div>

        <!-- Finished Products Section -->
        <div class="section-header">
            üè≠ Finished Products (Ready for Dispatch)
        </div>
        <div class="labels-grid" id="productsContainer">
            <!-- Product barcode labels will be generated here -->
        </div>
    </div>

    <script>
        let inventoryItems = [];
        let finishedProducts = [];

        // Fallback raw material components
        const fallbackComponents = [
            "Casting set", "Frame", "Cover", "Gasket", "Oil seal", "Piston", "Liner", "Crank",
            "Con rod", "Pin-Gudgun", "Rings", "Bearing", "Bearing washer", "C.S.bolt",
            "Oil pump", "Gasket set", "Oil", "Assembly", "Main parts", "Belt", "Pulley",
            "V Belt", "Motor 3hp", "Motor 5hp", "Motor 7.5hp", "Motor 10hp", "Starter",
            "MCB", "Pressure switch", "Check valve", "Tank", "Safety valve", "Pressure gauge",
            "Bolt-Nut", "Washer", "Auto drain", "Manual drain", "Solenoid valve", "Timer",
            "L Bend-G.I", "Nipple", "Bend", "Union", "Reducer", "Adopter", "Ball valve",
            "Needle valve", "Pipe", "Coupling", "Filter element", "Body", "NRV", "Hose clip",
            "Tee", "Hose pipe", "Clamp", "T.C.1000", "Packing set", "Hermet nipple",
            "Reducer", "Damming pipe", "Breather nipple"
        ];

        // Finished Products with proper barcodes
        const fallbackProducts = [
            // Air Compressors
            { name: 'Air Compressor - 1hp', barcode: 'FP-AC-001', category: 'Air Compressor' },
            { name: 'Air Compressor - 2hp', barcode: 'FP-AC-002', category: 'Air Compressor' },
            { name: 'Air Compressor - 5hp', barcode: 'FP-AC-005', category: 'Air Compressor' },
            { name: 'Air Compressor - 7.5hp', barcode: 'FP-AC-007', category: 'Air Compressor' },
            { name: 'Air Compressor - 10hp', barcode: 'FP-AC-010', category: 'Air Compressor' },
            { name: 'Air Compressor - 15hp', barcode: 'FP-AC-015', category: 'Air Compressor' },
            
            // Screw Compressors
            { name: 'Screw Compressor - 5hp', barcode: 'FP-SC-005', category: 'Screw Compressor' },
            { name: 'Screw Compressor - 7.5hp', barcode: 'FP-SC-007', category: 'Screw Compressor' },
            { name: 'Screw Compressor - 10hp', barcode: 'FP-SC-010', category: 'Screw Compressor' },
            { name: 'Screw Compressor - 15hp', barcode: 'FP-SC-015', category: 'Screw Compressor' },
            { name: 'Screw Compressor - 20hp', barcode: 'FP-SC-020', category: 'Screw Compressor' },
            { name: 'Screw Compressor - 30hp', barcode: 'FP-SC-030', category: 'Screw Compressor' },
            { name: 'Screw Compressor - 50hp', barcode: 'FP-SC-050', category: 'Screw Compressor' },
            
            // Air Dryers
            { name: 'Air Dryer - 20CFM', barcode: 'FP-AD-020', category: 'Air Dryer' },
            { name: 'Air Dryer - 40CFM', barcode: 'FP-AD-040', category: 'Air Dryer' },
            { name: 'Air Dryer - 80CFM', barcode: 'FP-AD-080', category: 'Air Dryer' },
            { name: 'Air Dryer - 120CFM', barcode: 'FP-AD-120', category: 'Air Dryer' },
            { name: 'Air Dryer - 200CFM', barcode: 'FP-AD-200', category: 'Air Dryer' },
            { name: 'Air Dryer - 300CFM', barcode: 'FP-AD-300', category: 'Air Dryer' },
            { name: 'Air Dryer - 500CFM', barcode: 'FP-AD-500', category: 'Air Dryer' },
            
            // Air Filters
            { name: 'Air Filter - 1/4" inch', barcode: 'FP-AF-025', category: 'Air Filter' },
            { name: 'Air Filter - 1/2" inch', barcode: 'FP-AF-050', category: 'Air Filter' },
            { name: 'Air Filter - 3/4" inch', barcode: 'FP-AF-075', category: 'Air Filter' },
            { name: 'Air Filter - 1" inch', barcode: 'FP-AF-100', category: 'Air Filter' },
            { name: 'Air Filter - 1 1/2" inch', barcode: 'FP-AF-150', category: 'Air Filter' },
            { name: 'Air Filter - 2" inch', barcode: 'FP-AF-200', category: 'Air Filter' },
            
            // Specialized Equipment
            { name: 'HeatLess Dryer', barcode: 'FP-SE-HLD', category: 'Specialized Equipment' },
            { name: 'Carbon Tower', barcode: 'FP-SE-CT', category: 'Specialized Equipment' },
            { name: 'Water Chiller', barcode: 'FP-SE-WC', category: 'Specialized Equipment' },
            { name: 'TMD Receiver Tank', barcode: 'FP-SE-TMD', category: 'Specialized Equipment' }
        ];

        async function fetchInventoryItems() {
            try {
                const response = await fetch('/api/inventory/items');
                if (response.ok) {
                    const data = await response.json();
                    inventoryItems = data.items || [];
                } else {
                    throw new Error('Failed to fetch inventory');
                }
            } catch (error) {
                console.warn('Using fallback inventory data');
                inventoryItems = fallbackComponents.map((name, index) => ({
                    name,
                    barcode: `COMP-${String(index + 1).padStart(3, '0')}`,
                    category: 'Component',
                    unit: 'pcs'
                }));
            }
        }

        async function fetchFinishedProducts() {
            try {
                const response = await fetch('/api/finished-products');
                if (response.ok) {
                    const data = await response.json();
                    finishedProducts = data.data || [];
                } else {
                    throw new Error('Failed to fetch finished products');
                }
            } catch (error) {
                console.warn('Using fallback finished products data');
                finishedProducts = fallbackProducts;
            }
        }

        async function refreshData() {
            await Promise.all([fetchInventoryItems(), fetchFinishedProducts()]);
            generateAllBarcodes();
        }

        function generateAllBarcodes() {
            generateComponentBarcodes();
            generateProductBarcodes();
            updateStats();
        }

        function generateComponentBarcodes() {
            const container = document.getElementById('componentsContainer');
            container.innerHTML = '';

            inventoryItems.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'label-card component';
                card.innerHTML = `
                    <div class="component-name">${item.name}</div>
                    <div class="category-badge">${item.category || 'Component'}</div>
                    <div class="barcode-container">
                        <svg id="comp-barcode-${index}"></svg>
                    </div>
                    <div class="serial-number">${item.barcode}</div>
                    <div class="serial-label">Raw Material</div>
                `;
                container.appendChild(card);

                JsBarcode(`#comp-barcode-${index}`, item.barcode, {
                    format: "CODE128",
                    width: 2,
                    height: 50,
                    displayValue: false,
                    lineColor: "#000000"
                });
            });
        }

        function generateProductBarcodes() {
            const container = document.getElementById('productsContainer');
            container.innerHTML = '';

            finishedProducts.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'label-card finished-product';
                card.innerHTML = `
                    <div class="component-name">${item.product_name || item.name}</div>
                    <div class="category-badge finished">${item.category}</div>
                    <div class="barcode-container">
                        <svg id="prod-barcode-${index}"></svg>
                    </div>
                    <div class="serial-number finished">${item.barcode}</div>
                    <div class="serial-label">Finished Product</div>
                `;
                container.appendChild(card);

                JsBarcode(`#prod-barcode-${index}`, item.barcode, {
                    format: "CODE128",
                    width: 2,
                    height: 50,
                    displayValue: false,
                    lineColor: "#000000"
                });
            });
        }

        function updateStats() {
            document.getElementById('componentCount').textContent = inventoryItems.length;
            document.getElementById('productCount').textContent = finishedProducts.length;
            document.getElementById('totalCount').textContent = inventoryItems.length + finishedProducts.length;
        }

        function downloadComponentsCSV() {
            let csv = 'Component Name,Barcode,Category,Unit\n';
            inventoryItems.forEach((item) => {
                csv += `"${item.name}","${item.barcode}","${item.category}","${item.unit}"\n`;
            });

            downloadCSV(csv, 'inventory-components.csv');
        }

        function downloadProductsCSV() {
            let csv = 'Product Name,Barcode,Category,Specification\n';
            finishedProducts.forEach((item) => {
                csv += `"${item.product_name || item.name}","${item.barcode}","${item.category}","${item.specification || ''}"\n`;
            });

            downloadCSV(csv, 'finished-products.csv');
        }

        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', async () => {
            await refreshData();
        });
    </script>
</body>
</html>
